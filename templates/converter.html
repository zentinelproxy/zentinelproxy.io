{% extends "base.html" %}

{% block title %}Config Converter | {{ config.title }}{% endblock %}
{% block description %}Convert nginx, HAProxy, Traefik, Caddy, and Envoy configurations to Sentinel KDL format{% endblock %}

{% block content %}
<section class="playground-hero">
    <div class="container">
        <h1 class="playground-title">
            <span class="gradient-text">Config Converter</span>
        </h1>
        <p class="playground-subtitle">
            Convert your existing proxy configurations to Sentinel KDL format
        </p>
    </div>
</section>

<section class="playground-main">
    <div class="container">
        <!-- Hidden format select for JS compatibility -->
        <select id="format-select" style="display: none;">
            <option value="auto" selected>Auto-detect</option>
            <option value="nginx">nginx</option>
            <option value="haproxy">HAProxy</option>
            <option value="traefik">Traefik</option>
            <option value="caddy">Caddy</option>
            <option value="envoy">Envoy</option>
        </select>

        <div class="converter-grid" id="converter-grid">
            <!-- Source Config Editor -->
            <div class="playground-panel config-panel" id="source-panel">
                <div class="panel-header">
                    <div class="panel-header-left">
                        <h2>Source Configuration</h2>
                    </div>
                    <div class="panel-header-actions">
                        <button type="button" class="panel-action-btn" id="copy-source-btn" title="Copy source">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                        </button>
                        <button type="button" class="panel-action-btn fullscreen-btn" id="fullscreen-source-btn" title="Toggle fullscreen split view">
                            <svg class="icon-expand" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></svg>
                            <svg class="icon-collapse" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" x2="21" y1="10" y2="3"/><line x1="3" x2="10" y1="21" y2="14"/></svg>
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div class="editor-overlay-controls">
                        <select id="sample-select" class="editor-sample-select" title="Load sample configuration">
                            <option value="">Load Sample...</option>
                            <option value="nginx">nginx - Basic proxy</option>
                            <option value="nginx-advanced">nginx - With rate limiting</option>
                            <option value="haproxy">HAProxy - Frontend/Backend</option>
                            <option value="traefik">Traefik - Routers & Services</option>
                            <option value="caddy">Caddy - Caddyfile</option>
                            <option value="envoy">Envoy - Listeners & Clusters</option>
                        </select>
                    </div>
                    <div class="editor-container">
                        <textarea id="source-editor" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Paste your nginx, HAProxy, Traefik, Caddy, or Envoy configuration here...">http {
    upstream backend {
        server 10.0.0.1:8080 weight=5;
        server 10.0.0.2:8080 weight=3;
        server 10.0.0.3:8080 backup;
    }

    server {
        listen 80;
        server_name example.com;

        location /api/ {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location / {
            root /var/www/html;
            index index.html;
        }
    }
}</textarea>
                    </div>
                </div>
                <div class="error-display" id="error-display"></div>
            </div>

            <!-- Separator -->
            <div class="converter-separator" id="converter-separator">
                <div class="separator-line"></div>
            </div>

            <!-- Output KDL -->
            <div class="playground-panel output-panel" id="output-panel">
                <div class="panel-header">
                    <h2>Sentinel KDL Output</h2>
                    <div class="panel-header-actions">
                        <div class="validation-status" id="validation-status">
                            <span class="status-icon" id="status-icon"></span>
                            <span class="status-text" id="status-text">Converted</span>
                        </div>
                        <button type="button" class="panel-action-btn" id="copy-output-btn" title="Copy KDL output">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                        </button>
                        <button type="button" class="panel-action-btn fullscreen-btn" id="fullscreen-output-btn" title="Toggle fullscreen split view">
                            <svg class="icon-expand" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></svg>
                            <svg class="icon-collapse" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" x2="21" y1="10" y2="3"/><line x1="3" x2="10" y1="21" y2="14"/></svg>
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div class="editor-container">
                        <pre class="editor-highlight" id="output-highlight"><code id="output-code"></code></pre>
                        <textarea id="output-editor" spellcheck="false" readonly placeholder="Converted KDL will appear here..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Convert Button -->
        <div class="convert-actions">
            <button type="button" class="btn btn-gradient convert-btn" id="convert-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                Convert to Sentinel KDL
            </button>
        </div>

        <!-- Detected Agents -->
        <div class="playground-panel agents-panel" id="agents-panel" style="display: none;">
            <div class="panel-header">
                <h2>Detected Agents</h2>
                <span class="agents-count" id="agents-count"></span>
            </div>
            <div class="agents-content" id="agents-content">
                <!-- Agent cards populated by JS -->
            </div>
        </div>

        <!-- Warnings -->
        <div class="playground-panel warnings-panel" id="warnings-panel" style="display: none;">
            <div class="panel-header">
                <h2>Conversion Notes</h2>
                <span class="warnings-count" id="warnings-count"></span>
            </div>
            <div class="warnings-content" id="warnings-content">
                <!-- Warnings populated by JS -->
            </div>
        </div>

        <!-- CLI Install Section -->
        <div class="playground-panel cli-install-panel">
            <div class="panel-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" x2="20" y1="19" y2="19"/></svg>
                    Use Offline
                </h2>
            </div>
            <div class="cli-install-content">
                <p class="cli-install-description">
                    For batch conversions, CI/CD pipelines, or offline use, install the <strong>sentinel-convert</strong> command-line tool.
                </p>
                <div class="cli-install-widget">
                    <div class="cli-install-tabs">
                        <button type="button" class="cli-install-tab active" data-method="cargo">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linejoin="round" stroke-width="1"><path stroke-linecap="round" d="M1.5 7L8 10.5L14.5 7m-10-2.5l3.503 2L14.498 3M4.5 5.5v7m3.5-6V14"/><path stroke-linecap="round" d="M8.003 3L11.5 4.5v8"/><path stroke-linecap="square" d="M1.5 6.984V11l6.503 3.5L14.5 11V3L11 1.5l-6.5 3v1z"/></g></svg>
                            Cargo
                        </button>
                        <button type="button" class="cli-install-tab" data-method="source">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                            From Source
                        </button>
                    </div>
                    <div class="cli-install-cmd-wrapper">
                        <code class="cli-install-cmd" id="cli-install-cmd">cargo install sentinel-convert</code>
                        <button type="button" class="panel-action-btn" id="cli-copy-btn" title="Copy to clipboard">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                        </button>
                    </div>
                </div>
                <div class="cli-code-block cli-usage-block">
                    <div class="cli-code-header">
                        <span class="cli-code-label">Usage</span>
                    </div>
                    <pre><code><span class="cli-prompt">$</span> sentinel-convert convert nginx.conf -o sentinel.kdl
<span class="cli-prompt">$</span> sentinel-convert convert haproxy.cfg --format haproxy
<span class="cli-prompt">$</span> sentinel-convert analyze traefik.yaml --suggest-agents</code></pre>
                </div>
            </div>
        </div>

        <!-- Info Box -->
        <div class="playground-info">
            <div class="info-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22v-9"/><path d="M15.17 2.21a1.67 1.67 0 0 1 1.63 0L21 4.57a1.93 1.93 0 0 1 0 3.36L8.82 14.79a1.655 1.655 0 0 1-1.64 0L3 12.43a1.93 1.93 0 0 1 0-3.36z"/><path d="M20 13v3.87a2.06 2.06 0 0 1-1.11 1.83l-6 3.08a1.93 1.93 0 0 1-1.78 0l-6-3.08A2.06 2.06 0 0 1 4 16.87V13"/><path d="M21 12.43a1.93 1.93 0 0 0 0-3.36L8.83 2.2a1.64 1.64 0 0 0-1.63 0L3 4.57a1.93 1.93 0 0 0 0 3.36l12.18 6.86a1.636 1.636 0 0 0 1.63 0z"/></svg>
                <span>Powered by <a href="https://www.rust-lang.org/" target="_blank" rel="noopener">Rust</a> + <a href="https://webassembly.org/" target="_blank" rel="noopener">WebAssembly</a></span>
            </div>
            <div class="info-content">
                <h3>Real Parsing, Real Conversion</h3>
                <p>This converter uses the <strong>actual sentinel-convert parser</strong> compiled to <a href="https://webassembly.org/" target="_blank" rel="noopener">WebAssembly</a>, running directly in your browser. The same <a href="https://www.rust-lang.org/" target="_blank" rel="noopener">Rust</a> code that powers the CLI tool parses your configuration and converts it to Sentinel's KDL format.</p>
                <p class="info-highlight">Supported formats: <strong>nginx</strong>, <strong>HAProxy</strong>, <strong>Traefik</strong>, <strong>Caddy</strong>, and <strong>Envoy</strong>. The converter automatically detects rate limiting, authentication, and WAF patterns to suggest Sentinel agents.</p>
            </div>
            <div class="info-version-badge" id="version-badge">
                <button type="button" class="version-badge-btn" id="version-badge-btn" title="Click for local runtime options">
                    <span>Converter Version: <span id="wasm-version">Loading...</span></span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div class="version-dropdown" id="version-dropdown">
                    <div class="version-dropdown-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                        <span>Run Locally</span>
                    </div>
                    <p class="version-dropdown-desc">Take the converter home. Run batch conversions locally with any WASI-compatible runtime.</p>
                    <div class="version-dropdown-actions">
                        <a href="/wasm/sentinel_convert_wasm_bg.wasm" download="sentinel_convert.wasm" class="btn btn-primary btn-small">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                            Download WASM
                            <span class="wasm-size">(~3.2 MB)</span>
                        </a>
                    </div>
                    <div class="version-dropdown-code">
                        <p class="code-label">Run with <a href="https://wasmtime.dev/" target="_blank" rel="noopener">Wasmtime</a>:</p>
                        <pre><code><span class="code-comment"># Install wasmtime</span>
curl https://wasmtime.dev/install.sh -sSf | bash

<span class="code-comment"># Convert nginx config</span>
wasmtime sentinel_convert.wasm nginx.conf -o sentinel.kdl

<span class="code-comment"># Convert with format hint</span>
wasmtime sentinel_convert.wasm config.txt --format haproxy</code></pre>
                    </div>
                    <div class="version-dropdown-runtimes">
                        <span class="runtimes-label">Also works with:</span>
                        <a href="https://wasmer.io/" target="_blank" rel="noopener">Wasmer</a>
                        <span class="separator">·</span>
                        <a href="https://wazero.io/" target="_blank" rel="noopener">wazero</a>
                        <span class="separator">·</span>
                        <a href="https://github.com/aspect-build/rules_esbuild" target="_blank" rel="noopener">Node.js</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script type="module" src="{{ get_url(path='js/converter.js') | safe }}"></script>
{% endblock %}
