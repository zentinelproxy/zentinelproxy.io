{% extends "base.html" %}

{% block title %}Config Converter | {{ config.title }}{% endblock %}
{% block description %}Convert nginx, HAProxy, Traefik, Caddy, and Envoy configurations to Sentinel KDL format{% endblock %}

{% block content %}
<section class="playground-hero">
    <div class="container">
        <h1 class="playground-title">
            <span class="gradient-text">Config Converter</span>
        </h1>
        <p class="playground-subtitle">
            Convert your existing proxy configurations to Sentinel KDL format
        </p>
    </div>
</section>

<section class="playground-main">
    <div class="container">
        <p class="playground-intro">Paste your configuration below or choose a sample to see how it converts to Sentinel KDL</p>

        <!-- Format Selector -->
        <div class="converter-controls">
            <div class="format-selector">
                <label for="format-select">Source Format:</label>
                <select id="format-select">
                    <option value="auto" selected>Auto-detect</option>
                    <option value="nginx">nginx</option>
                    <option value="haproxy">HAProxy</option>
                    <option value="traefik">Traefik</option>
                    <option value="caddy">Caddy</option>
                    <option value="envoy">Envoy</option>
                </select>
            </div>
            <div class="sample-selector">
                <label for="sample-select">Load Sample:</label>
                <select id="sample-select">
                    <option value="">Choose a sample...</option>
                    <option value="nginx">nginx - Basic proxy</option>
                    <option value="nginx-advanced">nginx - With rate limiting</option>
                    <option value="haproxy">HAProxy - Frontend/Backend</option>
                    <option value="traefik">Traefik - Routers & Services</option>
                    <option value="caddy">Caddy - Caddyfile</option>
                    <option value="envoy">Envoy - Listeners & Clusters</option>
                </select>
            </div>
        </div>

        <div class="converter-grid">
            <!-- Source Config Editor -->
            <div class="playground-panel config-panel" id="source-panel">
                <div class="panel-header">
                    <h2>Source Configuration</h2>
                    <div class="panel-header-actions">
                        <div class="validation-status" id="validation-status">
                            <span class="status-icon" id="status-icon"></span>
                            <span class="status-text" id="status-text">Loading...</span>
                        </div>
                        <button type="button" class="panel-action-btn" id="copy-source-btn" title="Copy source">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div class="editor-container">
                        <textarea id="source-editor" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Paste your nginx, HAProxy, Traefik, Caddy, or Envoy configuration here...">http {
    upstream backend {
        server 10.0.0.1:8080 weight=5;
        server 10.0.0.2:8080 weight=3;
        server 10.0.0.3:8080 backup;
    }

    server {
        listen 80;
        server_name example.com;

        location /api/ {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location / {
            root /var/www/html;
            index index.html;
        }
    }
}</textarea>
                    </div>
                </div>
                <div class="error-display" id="error-display"></div>
            </div>

            <!-- Output KDL -->
            <div class="playground-panel output-panel" id="output-panel">
                <div class="panel-header">
                    <h2>Sentinel KDL Output</h2>
                    <div class="panel-header-actions">
                        <span class="detected-format" id="detected-format"></span>
                        <button type="button" class="panel-action-btn" id="copy-output-btn" title="Copy KDL output">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div class="editor-container">
                        <pre class="editor-highlight" id="output-highlight"><code id="output-code"></code></pre>
                        <textarea id="output-editor" spellcheck="false" readonly placeholder="Converted KDL will appear here..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Convert Button -->
        <div class="convert-actions">
            <button type="button" class="btn btn-gradient convert-btn" id="convert-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                Convert to Sentinel KDL
            </button>
        </div>

        <!-- Detected Agents -->
        <div class="playground-panel agents-panel" id="agents-panel" style="display: none;">
            <div class="panel-header">
                <h2>Detected Agents</h2>
                <span class="agents-count" id="agents-count"></span>
            </div>
            <div class="agents-content" id="agents-content">
                <!-- Agent cards populated by JS -->
            </div>
        </div>

        <!-- Warnings -->
        <div class="playground-panel warnings-panel" id="warnings-panel" style="display: none;">
            <div class="panel-header">
                <h2>Conversion Notes</h2>
                <span class="warnings-count" id="warnings-count"></span>
            </div>
            <div class="warnings-content" id="warnings-content">
                <!-- Warnings populated by JS -->
            </div>
        </div>

        <!-- Info Box -->
        <div class="playground-info">
            <div class="info-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22v-9"/><path d="M15.17 2.21a1.67 1.67 0 0 1 1.63 0L21 4.57a1.93 1.93 0 0 1 0 3.36L8.82 14.79a1.655 1.655 0 0 1-1.64 0L3 12.43a1.93 1.93 0 0 1 0-3.36z"/><path d="M20 13v3.87a2.06 2.06 0 0 1-1.11 1.83l-6 3.08a1.93 1.93 0 0 1-1.78 0l-6-3.08A2.06 2.06 0 0 1 4 16.87V13"/><path d="M21 12.43a1.93 1.93 0 0 0 0-3.36L8.83 2.2a1.64 1.64 0 0 0-1.63 0L3 4.57a1.93 1.93 0 0 0 0 3.36l12.18 6.86a1.636 1.636 0 0 0 1.63 0z"/></svg>
                <span>Powered by <a href="https://www.rust-lang.org/" target="_blank" rel="noopener">Rust</a> + <a href="https://webassembly.org/" target="_blank" rel="noopener">WebAssembly</a></span>
            </div>
            <div class="info-content">
                <h3>Real Parsing, Real Conversion</h3>
                <p>This converter uses the <strong>actual sentinel-convert parser</strong> compiled to <a href="https://webassembly.org/" target="_blank" rel="noopener">WebAssembly</a>, running directly in your browser. The same <a href="https://www.rust-lang.org/" target="_blank" rel="noopener">Rust</a> code that powers the CLI tool parses your configuration and converts it to Sentinel's KDL format.</p>
                <p class="info-highlight">Supported formats: <strong>nginx</strong>, <strong>HAProxy</strong>, <strong>Traefik</strong>, <strong>Caddy</strong>, and <strong>Envoy</strong>. The converter automatically detects rate limiting, authentication, and WAF patterns to suggest Sentinel agents.</p>
            </div>
            <div class="info-version-badge">
                <span>Converter Version: <span id="wasm-version">v0.0.0</span></span>
            </div>
        </div>

        <!-- CLI Install Section -->
        <div class="cli-install-section">
            <div class="cli-install-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" x2="20" y1="19" y2="19"/></svg>
                <h3>Install the CLI</h3>
            </div>
            <p class="cli-install-description">
                For batch conversions, CI/CD pipelines, or offline use, install the <strong>sentinel-convert</strong> command-line tool.
            </p>
            <div class="cli-install-methods">
                <div class="code-output">
                    <div class="code-header">
                        <span class="code-label">Cargo</span>
                        <button class="copy-btn" onclick="copyCLICommand(this, 'cargo install sentinel-convert')" title="Copy command">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                            <span>Copy</span>
                        </button>
                    </div>
                    <pre><code id="cargo-install-code">cargo install sentinel-convert</code></pre>
                </div>
                <div class="code-output">
                    <div class="code-header">
                        <span class="code-label">From Source</span>
                        <button class="copy-btn" onclick="copyCLICommand(this, 'git clone https://github.com/raskell-io/sentinel-convert && cd sentinel-convert && cargo install --path .')" title="Copy command">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                            <span>Copy</span>
                        </button>
                    </div>
                    <pre><code id="source-install-code">git clone https://github.com/raskell-io/sentinel-convert && cd sentinel-convert && cargo install --path .</code></pre>
                </div>
            </div>
            <div class="code-output">
                <div class="code-header">
                    <span class="code-label">Usage</span>
                </div>
                <pre><code><span class="cli-prompt">$</span> sentinel-convert convert nginx.conf -o sentinel.kdl
<span class="cli-prompt">$</span> sentinel-convert convert haproxy.cfg --format haproxy
<span class="cli-prompt">$</span> sentinel-convert analyze traefik.yaml --suggest-agents</code></pre>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script type="module" src="{{ get_url(path='js/converter.js') | safe }}"></script>
{% endblock %}
