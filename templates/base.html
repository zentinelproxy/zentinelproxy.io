<!DOCTYPE html>
<html lang="{{ lang | default(value='en') }}" prefix="og: https://ogp.me/ns#" data-theme="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark light">

    <!-- Primary Meta Tags -->
    <title>{% block title %}{{ config.title }}{% endblock %}</title>
    <meta name="description" content="{% block description %}{{ config.description }}{% endblock %}">
    {% if page.taxonomies.tags %}
    <meta name="keywords" content="{{ page.taxonomies.tags | join(sep=', ') }}">
    {% elif section.extra.keywords %}
    <meta name="keywords" content="{{ section.extra.keywords }}">
    {% elif config.extra.keywords %}
    <meta name="keywords" content="{{ config.extra.keywords }}">
    {% endif %}
    <meta name="author" content="{{ config.extra.author }}">

    <!-- Search Engine Meta Tags -->
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">

    <!-- Canonical URL -->
    {% if current_url %}
    <link rel="canonical" href="{{ current_url | safe }}">
    {% else %}
    <link rel="canonical" href="{{ config.base_url | safe }}">
    {% endif %}

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="{% if page %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ current_url | default(value=config.base_url) | safe }}">
    <meta property="og:title" content="{% block og_title %}{{ config.title }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ config.description }}{% endblock %}">
    <meta property="og:image" content="{{ get_url(path='img/og-image.png') | safe }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{% block og_image_alt %}{{ config.title }} - {{ config.description }}{% endblock %}">
    <meta property="og:site_name" content="{{ config.title }}">
    <meta property="og:locale" content="{{ lang | default(value='en') | replace(from='-', to='_') }}">
    {% if page.date %}
    <meta property="article:published_time" content="{{ page.date | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00">
    {% endif %}
    {% if page.updated %}
    <meta property="article:modified_time" content="{{ page.updated | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00">
    {% endif %}
    {% if page.taxonomies.tags %}
    {% for tag in page.taxonomies.tags %}
    <meta property="article:tag" content="{{ tag }}">
    {% endfor %}
    {% endif %}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ current_url | default(value=config.base_url) | safe }}">
    <meta name="twitter:title" content="{% block twitter_title %}{{ config.title }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ config.description }}{% endblock %}">
    <meta name="twitter:image" content="{{ get_url(path='img/og-image.png') | safe }}">
    <meta name="twitter:image:alt" content="{% block twitter_image_alt %}{{ config.title }} - {{ config.description }}{% endblock %}">
    {% if config.extra.twitter_handle %}
    <meta name="twitter:site" content="{{ config.extra.twitter_handle }}">
    {% endif %}

    <!-- Preload fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="{{ get_url(path='style.css') | safe }}">

    <!-- Favicon -->
    <link rel="icon" href="{{ get_url(path='favicon.ico') | safe }}" sizes="48x48">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ get_url(path='favicon.png') | safe }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ get_url(path='icon-192.png') | safe }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ get_url(path='apple-touch-icon.png') | safe }}">
    <link rel="manifest" href="{{ get_url(path='site.webmanifest') | safe }}">

    <!-- Theme detection script - runs before paint -->
    <script>
        (function() {
            const stored = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = stored || (prefersDark ? 'dark' : 'light');
            document.documentElement.dataset.theme = theme;
        })();
    </script>

    <!-- Feed -->
    <link rel="alternate" type="application/atom+xml" title="Sentinel Feed" href="{{ get_url(path='atom.xml') | safe }}">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@graph": [
            {
                "@type": "WebSite",
                "@id": "{{ config.base_url | safe }}/#website",
                "url": "{{ config.base_url | safe }}",
                "name": "{{ config.title }}",
                "description": "{{ config.description }}",
                "publisher": {
                    "@id": "{{ config.base_url | safe }}/#organization"
                },
                "inLanguage": "{{ lang | default(value='en') }}",
                "potentialAction": {
                    "@type": "SearchAction",
                    "target": {
                        "@type": "EntryPoint",
                        "urlTemplate": "{{ config.base_url | safe }}/?q={search_term_string}"
                    },
                    "query-input": "required name=search_term_string"
                }
            },
            {
                "@type": "SoftwareApplication",
                "@id": "{{ config.base_url | safe }}/#software",
                "name": "Sentinel",
                "description": "A security-first reverse proxy built on Cloudflare Pingora for production deployments",
                "url": "{{ config.base_url | safe }}",
                "applicationCategory": "DeveloperApplication",
                "operatingSystem": "Linux, macOS",
                "softwareVersion": "0.4.2",
                "downloadUrl": "https://github.com/raskell-io/sentinel/releases",
                "installUrl": "https://sentinel.raskell.io/docs/getting-started/installation/",
                "screenshot": "{{ get_url(path='img/og-image.png') | safe }}",
                "author": {
                    "@id": "{{ config.base_url | safe }}/#organization"
                },
                "offers": {
                    "@type": "Offer",
                    "price": "0",
                    "priceCurrency": "USD"
                },
                "license": "https://opensource.org/licenses/Apache-2.0",
                "programmingLanguage": "Rust",
                "codeRepository": "https://github.com/raskell-io/sentinel",
                "featureList": [
                    "TLS termination with OCSP stapling",
                    "14+ load balancing algorithms",
                    "HTTP, TCP, gRPC health checks",
                    "External agent extensibility",
                    "Hot configuration reload",
                    "Prometheus metrics",
                    "OpenTelemetry tracing",
                    "WebSocket support",
                    "GeoIP filtering",
                    "Response caching"
                ]
            },
            {
                "@type": "Organization",
                "@id": "{{ config.base_url | safe }}/#organization",
                "name": "{{ config.extra.author }}",
                "url": "{{ config.base_url | safe }}",
                "logo": {
                    "@type": "ImageObject",
                    "url": "{{ get_url(path='img/og-image.png') | safe }}",
                    "width": 1200,
                    "height": 630
                }
            },
            {
                "@type": "WebPage",
                "@id": "{{ current_url | default(value=config.base_url) | safe }}/#webpage",
                "url": "{{ current_url | default(value=config.base_url) | safe }}",
                "name": "{% block jsonld_title %}{{ config.title }}{% endblock %}",
                "description": "{% block jsonld_description %}{{ config.description }}{% endblock %}",
                "isPartOf": {
                    "@id": "{{ config.base_url | safe }}/#website"
                },
                "inLanguage": "{{ lang | default(value='en') }}"
                {% if page.date %},
                "datePublished": "{{ page.date | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00"
                {% endif %}
                {% if page.updated %},
                "dateModified": "{{ page.updated | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00"
                {% endif %}
            }
            {% if page %},
            {
                "@type": "Article",
                "@id": "{{ current_url | safe }}/#article",
                "headline": "{{ page.title }}",
                "description": "{{ page.description | default(value=config.description) }}",
                "url": "{{ current_url | safe }}",
                "isPartOf": {
                    "@id": "{{ current_url | safe }}/#webpage"
                },
                "mainEntityOfPage": {
                    "@id": "{{ current_url | safe }}/#webpage"
                },
                "inLanguage": "{{ lang | default(value='en') }}",
                "author": {
                    "@type": "Organization",
                    "@id": "{{ config.base_url | safe }}/#organization"
                },
                "publisher": {
                    "@id": "{{ config.base_url | safe }}/#organization"
                }
                {% if page.date %},
                "datePublished": "{{ page.date | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00"
                {% endif %}
                {% if page.updated %},
                "dateModified": "{{ page.updated | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00"
                {% endif %}
                {% if page.taxonomies.tags %},
                "keywords": "{{ page.taxonomies.tags | join(sep=', ') }}"
                {% endif %}
                {% if page.word_count %},
                "wordCount": {{ page.word_count }}
                {% endif %}
            }
            {% endif %}
            {% block jsonld_breadcrumb %}{% endblock %}
        ]
    }
    </script>

    {% block head %}{% endblock %}
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="layout">
        <header class="header" role="banner">
            <div class="container">
                <nav class="nav" role="navigation" aria-label="Main navigation">
                    <a href="{{ get_url(path='/') }}" class="logo" aria-label="Sentinel Home">
                        <img src="{{ get_url(path='img/sentinel-mascot.avif') | safe }}" alt="Sentinel" class="logo-img">
                        <span class="logo-text">Sentinel</span>
                    </a>
                    <div class="nav-links">
                        {% if config.build_search_index %}
                        <button class="search-toggle" type="button" aria-label="Search" title="Search (/)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.3-4.3"/>
                            </svg>
                        </button>
                        {% endif %}
                        {% for link in config.extra.nav_links %}
                        {% if link.name == "GitHub" or link.external %}
                        <a href="{{ link.url }}" target="_blank" rel="noopener" class="nav-icon-link" aria-label="GitHub repository">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                        </a>
                        {% elif link.children %}
                        <div class="nav-dropdown">
                            <button class="nav-dropdown__trigger" type="button" aria-expanded="false" aria-haspopup="true">
                                {{ link.name }}
                                <svg class="nav-dropdown__chevron" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m6 9 6 6 6-6"/></svg>
                            </button>
                            <div class="nav-dropdown__menu" role="menu">
                                {% for child in link.children %}
                                <a href="{{ child.url }}" role="menuitem"{% if child.external %} target="_blank" rel="noopener"{% endif %}>
                                    {{ child.name }}
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        {% else %}
                        <a href="{{ link.url }}" {% if link.url is starting_with("http") %}target="_blank" rel="noopener"{% endif %}>
                            {{ link.name }}
                        </a>
                        {% endif %}
                        {% endfor %}
                        <button class="theme-toggle" aria-label="Toggle theme" aria-live="polite" onclick="toggleTheme()">
                            <svg class="icon-sun" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                            <svg class="icon-moon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                            <span class="sr-only" id="theme-status">Theme: auto</span>
                        </button>
                    </div>
                    <button class="mobile-menu-btn" aria-label="Open navigation menu" aria-expanded="false" aria-controls="mobileMenu" onclick="toggleMobileMenu()">
                        <svg class="icon-menu" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                        <svg class="icon-close" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" id="mobileMenu" role="dialog" aria-modal="true" aria-label="Navigation menu" aria-hidden="true">
            <button class="mobile-menu-close" aria-label="Close navigation menu" onclick="closeMobileMenu()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
            <nav class="mobile-menu-content" role="navigation" aria-label="Mobile navigation">
                {% for link in config.extra.nav_links %}
                {% if link.name == "GitHub" or link.external %}
                <a href="{{ link.url }}" class="mobile-menu-link mobile-menu-link--icon" target="_blank" rel="noopener">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                    GitHub
                </a>
                {% elif link.children %}
                <div class="mobile-nav-group">
                    <span class="mobile-nav-group__label">{{ link.name }}</span>
                    {% for child in link.children %}
                    <a href="{{ child.url }}" class="mobile-menu-link" {% if child.external %}target="_blank" rel="noopener"{% endif %}>
                        {{ child.name }}
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <a href="{{ link.url }}" class="mobile-menu-link" {% if link.url is starting_with("http") %}target="_blank" rel="noopener"{% endif %}>
                    {{ link.name }}
                </a>
                {% endif %}
                {% endfor %}
                {% if config.build_search_index %}
                <button class="mobile-menu-link search-toggle" type="button" aria-label="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.3-4.3"/>
                    </svg>
                    <span>Search</span>
                </button>
                {% endif %}
                <button class="mobile-theme-toggle" aria-label="Toggle theme" onclick="toggleTheme()">
                    <svg class="icon-sun" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                    <svg class="icon-moon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                    <span>Toggle Theme</span>
                </button>
            </nav>
        </div>

        <main id="main-content" class="main" role="main" aria-label="Main content">
            {% block content %}{% endblock %}
        </main>

        <footer class="footer" role="contentinfo">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-brand">
                        <div class="footer-mascot-wrapper" aria-hidden="true">
                            <div class="footer-mascot-glow"></div>
                            <img src="{{ get_url(path='img/sentinel-mascot.avif') | safe }}" alt="" class="footer-mascot">
                        </div>
                        <div class="footer-tagline">
                            <p class="footer-title">Security-first reverse proxy<br>built to guard the free web</p>
                            <p class="footer-description">A high-performance, security-focused reverse proxy built on Cloudflare's Pingora framework. Sleepable ops at the edge with extensible agent architecture.</p>
                        </div>
                    </div>
                    <nav class="footer-links" role="navigation" aria-label="Footer navigation">
                        <div class="footer-col">
                            <h4>Product</h4>
                            <a href="/features/">Features</a>
                            <a href="/agents/">Agent Registry</a>
                            <a href="/playground/">Playground</a>
                            <a href="/converter/">Converter</a>
                            <a href="/customize/">Install</a>
                        </div>
                        <div class="footer-col">
                            <h4>Learn</h4>
                            <a href="/docs/">Documentation</a>
                            <a href="/docs/getting-started/">Getting Started</a>
                            <a href="/docs/configuration/">Configuration</a>
                            <a href="/docs/examples/">Examples</a>
                            <a href="/docs/reference/">Reference</a>
                        </div>
                        <div class="footer-col">
                            <h4>About</h4>
                            <a href="/manifesto/">Manifesto</a>
                            <a href="/support/">Support</a>
                            <a href="/benchmarks/">Benchmarks</a>
                            <a href="/blog/">Blog</a>
                            <a href="/docs/appendix/changelog/">Changelog</a>
                            <a href="/docs/appendix/faq/">FAQ</a>
                            <a href="{{ config.extra.github }}/blob/main/LICENSE">License</a>
                        </div>
                        <div class="footer-col">
                            <h4>Community</h4>
                            <a href="{{ config.extra.github }}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                                GitHub
                            </a>
                            <a href="{{ config.extra.github }}/issues">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1" fill="currentColor"/></svg>
                                Issues
                            </a>
                            <a href="{{ config.extra.github }}/discussions">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M8 10h.01"/><path d="M12 10h.01"/><path d="M16 10h.01"/></svg>
                                Discussions
                            </a>
                            <a href="{{ config.extra.github }}/blob/main/CONTRIBUTING.md">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                                Contributing
                            </a>
                        </div>
                    </nav>
                </div>
                <div class="footer-bottom">
                    <p>Sentinel is licensed under <a href="https://github.com/raskell-io/sentinel/blob/main/LICENSE" target="_blank" rel="noopener">Apache 2.0</a>. Website &copy; {{ now() | date(format='%Y') }} <a href="https://raskell.io">raskell.io</a>.</p>
                </div>
            </div>
            <a href="https://learn-you-the-web.raskell.io/" target="_blank" rel="noopener" class="page-peel" aria-label="Learn You The Web - An e-book about how the web works">
                <span class="page-peel-tooltip" aria-hidden="true">
                    <strong>Learn You The Web</strong>
                    <span>An e-book about how the web works, inspired by "Learn You a Haskell for Great Good!"</span>
                </span>
            </a>
        </footer>

        {% if config.build_search_index %}
        {% include "partials/search.html" %}
        {% endif %}
    </div>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.dataset.theme;
            const next = current === 'dark' ? 'light' : 'dark';
            html.dataset.theme = next;
            localStorage.setItem('theme', next);
            // Update screen reader status
            const statusEl = document.getElementById('theme-status');
            if (statusEl) {
                statusEl.textContent = 'Theme: ' + next;
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const btn = document.querySelector('.mobile-menu-btn');
            const isOpen = menu.classList.toggle('open');
            btn.classList.toggle('open', isOpen);
            btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            btn.setAttribute('aria-label', isOpen ? 'Close navigation menu' : 'Open navigation menu');
            menu.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
            document.body.style.overflow = isOpen ? 'hidden' : '';
            // Focus management for accessibility
            if (isOpen) {
                const firstLink = menu.querySelector('.mobile-menu-link');
                if (firstLink) firstLink.focus();
            }
        }

        function closeMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const btn = document.querySelector('.mobile-menu-btn');
            menu.classList.remove('open');
            btn.classList.remove('open');
            btn.setAttribute('aria-expanded', 'false');
            btn.setAttribute('aria-label', 'Open navigation menu');
            menu.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        // Close mobile menu when clicking a link
        document.querySelectorAll('.mobile-menu-link').forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });

        // Close mobile menu on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeMobileMenu();
            }
        });

        // Navigation Dropdowns (portal approach for backdrop-filter compatibility)
        (function() {
            const dropdowns = document.querySelectorAll('.nav-dropdown');
            let activeDropdown = null;
            let activeMenu = null;
            let activeTrigger = null;
            let originalParent = null;

            function positionDropdown(trigger, menu) {
                const rect = trigger.getBoundingClientRect();
                const header = document.querySelector('.header');
                const headerBottom = header ? header.getBoundingClientRect().bottom : rect.bottom + 8;
                const menuWidth = menu.offsetWidth || 180;
                const left = rect.left + (rect.width / 2) - (menuWidth / 2);

                menu.style.left = Math.max(8, left) + 'px';
                menu.style.top = headerBottom + 'px';
            }

            function closeActiveDropdown() {
                if (activeDropdown && activeMenu && originalParent) {
                    activeDropdown.classList.remove('open');
                    activeMenu.classList.remove('open');
                    activeTrigger.setAttribute('aria-expanded', 'false');
                    // Move menu back to original parent
                    originalParent.appendChild(activeMenu);
                    activeDropdown = null;
                    activeMenu = null;
                    activeTrigger = null;
                    originalParent = null;
                }
            }

            dropdowns.forEach(dropdown => {
                const trigger = dropdown.querySelector('.nav-dropdown__trigger');
                const menu = dropdown.querySelector('.nav-dropdown__menu');

                if (trigger && menu) {
                    trigger.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();

                        const isOpen = dropdown.classList.contains('open');

                        // Close any other open dropdown
                        if (activeDropdown && activeDropdown !== dropdown) {
                            closeActiveDropdown();
                        }

                        if (isOpen) {
                            closeActiveDropdown();
                        } else {
                            dropdown.classList.add('open');
                            trigger.setAttribute('aria-expanded', 'true');
                            activeDropdown = dropdown;
                            activeMenu = menu;
                            activeTrigger = trigger;
                            originalParent = menu.parentElement;
                            // Move menu to body (portal) for backdrop-filter to work
                            document.body.appendChild(menu);
                            positionDropdown(trigger, menu);
                            menu.classList.add('open');
                        }
                    });

                    // Close on menu link click
                    menu.querySelectorAll('a').forEach(link => {
                        link.addEventListener('click', closeActiveDropdown);
                    });
                }
            });

            // Reposition on scroll/resize
            window.addEventListener('scroll', () => {
                if (activeDropdown && activeMenu && activeTrigger) {
                    positionDropdown(activeTrigger, activeMenu);
                }
            }, { passive: true });

            window.addEventListener('resize', () => {
                if (activeDropdown && activeMenu && activeTrigger) {
                    positionDropdown(activeTrigger, activeMenu);
                }
            }, { passive: true });

            // Close on outside click
            document.addEventListener('click', (e) => {
                if (activeDropdown && !activeDropdown.contains(e.target) && !activeMenu.contains(e.target)) {
                    closeActiveDropdown();
                }
            });

            // Close on escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && activeDropdown) {
                    closeActiveDropdown();
                }
            });
        })();
    </script>

    {% if config.build_search_index %}
    <script src="{{ get_url(path='elasticlunr.min.js') | safe }}"></script>
    <script src="{{ get_url(path='search_index.en.js') | safe }}"></script>
    <script src="{{ get_url(path='js/search-raskell.js') | safe }}" defer></script>
    {% endif %}

    {% block scripts %}{% endblock %}
</body>
</html>
