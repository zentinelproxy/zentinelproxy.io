{% extends "base.html" %}

{% block title %}{{ section.title }} | {{ config.title }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>{{ section.title }}</h1>
        <p>{{ section.description }}</p>
    </div>
</div>

<section class="agents-section">
    <div class="container">
        {# Search bar #}
        <div class="agents-search">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input type="text" id="agent-search" placeholder="Search agents..." autocomplete="off">
        </div>

        {# Separate official and community agents #}
        {% set official_agents = section.pages | filter(attribute="extra.official", value=true) %}
        {% set community_agents = section.pages | filter(attribute="extra.official", value=false) | sort(attribute="title") %}

        {# Sort official agents by status: Stable first, then Beta, then Planned #}
        {% set stable_agents = official_agents | filter(attribute="extra.status", value="Stable") %}
        {% set beta_agents = official_agents | filter(attribute="extra.status", value="Beta") %}
        {% set planned_agents = official_agents | filter(attribute="extra.status", value="Planned") %}

        {# Official Agents #}
        {% if official_agents %}
        <details class="agents-category" open>
            <summary class="category-header">
                <div class="category-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>
                    <h2>Official Agents</h2>
                </div>
                <div class="category-meta">
                    <span class="agent-count">{{ official_agents | length }} agents</span>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </div>
            </summary>
            <p class="category-description">Maintained by the Sentinel Core Team</p>
            <div class="agents-grid">
                {# Iterate in order: Stable, Beta, Planned #}
                {% for agent in stable_agents %}
                <article class="agent-card agent-official" data-agent-name="{{ agent.title | lower }}" data-agent-description="{{ agent.description | default(value='') | lower }}" data-agent-tags="{% if agent.taxonomies.tags %}{{ agent.taxonomies.tags | join(sep=' ') | lower }}{% endif %}">
                    <div class="agent-header">
                        <div class="agent-info">
                            <h3 class="agent-name">
                                <a href="{{ agent.permalink | safe }}">{{ agent.title }}</a>
                            </h3>
                            {% if agent.extra.author %}
                            <p class="agent-author">by {{ agent.extra.author }}</p>
                            {% endif %}
                        </div>
                        <div class="agent-header-right">
                            {% if agent.extra.version %}
                            <span class="agent-version">v{{ agent.extra.version }}</span>
                            {% endif %}
                            {% if agent.extra.status %}
                            <span class="agent-status {{ agent.extra.status | lower }}">{{ agent.extra.status }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <p class="agent-description">{{ agent.description | default(value="No description available.") }}</p>

                    {# Install methods badges #}
                    {% if agent.extra.crate_name or agent.extra.docker_image %}
                    <div class="agent-install-badges">
                        {% if agent.extra.crate_name %}
                        <span class="install-badge cargo" title="cargo install {{ agent.extra.crate_name }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 16 16"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linejoin="round" stroke-width="1"><path stroke-linecap="round" d="M1.5 7L8 10.5L14.5 7m-10-2.5l3.503 2L14.498 3M4.5 5.5v7m3.5-6V14"/><path stroke-linecap="round" d="M8.003 3L11.5 4.5v8"/><path stroke-linecap="square" d="M1.5 6.984V11l6.503 3.5L14.5 11V3L11 1.5l-6.5 3v1z"/></g></svg>
                            Cargo
                        </span>
                        {% endif %}
                        {% if agent.extra.docker_image %}
                        <span class="install-badge docker" title="docker pull {{ agent.extra.docker_image }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path fill="currentColor" d="M13.152.682a2.25 2.25 0 0 1 2.269 0l.007.004l6.957 4.276a2.28 2.28 0 0 1 1.126 1.964v7.516c0 .81-.432 1.56-1.133 1.968l-.002.001l-11.964 7.037l-.004.003c-.706.41-1.578.41-2.284 0l-.026-.015l-6.503-4.502a2.27 2.27 0 0 1-1.096-1.943V9.438c0-.392.1-.77.284-1.1l.003-.006l.014-.026c.197-.342.48-.627.82-.827h.002L13.152.681Zm.757 1.295h-.001L2.648 8.616l6.248 4.247a.78.78 0 0 0 .758-.01h.001l11.633-6.804l-6.629-4.074a.75.75 0 0 0-.75.003ZM8.517 14.33a2.3 2.3 0 0 1-.393-.18l-.023-.014l-6.102-4.147v7.003c0 .275.145.528.379.664l.025.014l6.114 4.232zM18 9.709l-3.25 1.9v7.548L18 17.245Zm-7.59 4.438l-.002.002a2.3 2.3 0 0 1-.391.18v7.612l3.233-1.902v-7.552Zm9.09-5.316v7.532l2.124-1.25a.78.78 0 0 0 .387-.671V7.363Z"/></svg>
                            OCI
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if agent.taxonomies.tags %}
                    <div class="agent-tags">
                        {% for tag in agent.taxonomies.tags %}
                        <span class="agent-tag">{{ tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </article>
                {% endfor %}
                {% for agent in beta_agents %}
                <article class="agent-card agent-official" data-agent-name="{{ agent.title | lower }}" data-agent-description="{{ agent.description | default(value='') | lower }}" data-agent-tags="{% if agent.taxonomies.tags %}{{ agent.taxonomies.tags | join(sep=' ') | lower }}{% endif %}">
                    <div class="agent-header">
                        <div class="agent-info">
                            <h3 class="agent-name">
                                <a href="{{ agent.permalink | safe }}">{{ agent.title }}</a>
                            </h3>
                            {% if agent.extra.author %}
                            <p class="agent-author">by {{ agent.extra.author }}</p>
                            {% endif %}
                        </div>
                        <div class="agent-header-right">
                            {% if agent.extra.version %}
                            <span class="agent-version">v{{ agent.extra.version }}</span>
                            {% endif %}
                            {% if agent.extra.status %}
                            <span class="agent-status {{ agent.extra.status | lower }}">{{ agent.extra.status }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <p class="agent-description">{{ agent.description | default(value="No description available.") }}</p>

                    {# Install methods badges #}
                    {% if agent.extra.crate_name or agent.extra.docker_image %}
                    <div class="agent-install-badges">
                        {% if agent.extra.crate_name %}
                        <span class="install-badge cargo" title="cargo install {{ agent.extra.crate_name }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 16 16"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linejoin="round" stroke-width="1"><path stroke-linecap="round" d="M1.5 7L8 10.5L14.5 7m-10-2.5l3.503 2L14.498 3M4.5 5.5v7m3.5-6V14"/><path stroke-linecap="round" d="M8.003 3L11.5 4.5v8"/><path stroke-linecap="square" d="M1.5 6.984V11l6.503 3.5L14.5 11V3L11 1.5l-6.5 3v1z"/></g></svg>
                            Cargo
                        </span>
                        {% endif %}
                        {% if agent.extra.docker_image %}
                        <span class="install-badge docker" title="docker pull {{ agent.extra.docker_image }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path fill="currentColor" d="M13.152.682a2.25 2.25 0 0 1 2.269 0l.007.004l6.957 4.276a2.28 2.28 0 0 1 1.126 1.964v7.516c0 .81-.432 1.56-1.133 1.968l-.002.001l-11.964 7.037l-.004.003c-.706.41-1.578.41-2.284 0l-.026-.015l-6.503-4.502a2.27 2.27 0 0 1-1.096-1.943V9.438c0-.392.1-.77.284-1.1l.003-.006l.014-.026c.197-.342.48-.627.82-.827h.002L13.152.681Zm.757 1.295h-.001L2.648 8.616l6.248 4.247a.78.78 0 0 0 .758-.01h.001l11.633-6.804l-6.629-4.074a.75.75 0 0 0-.75.003ZM8.517 14.33a2.3 2.3 0 0 1-.393-.18l-.023-.014l-6.102-4.147v7.003c0 .275.145.528.379.664l.025.014l6.114 4.232zM18 9.709l-3.25 1.9v7.548L18 17.245Zm-7.59 4.438l-.002.002a2.3 2.3 0 0 1-.391.18v7.612l3.233-1.902v-7.552Zm9.09-5.316v7.532l2.124-1.25a.78.78 0 0 0 .387-.671V7.363Z"/></svg>
                            OCI
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if agent.taxonomies.tags %}
                    <div class="agent-tags">
                        {% for tag in agent.taxonomies.tags %}
                        <span class="agent-tag">{{ tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </article>
                {% endfor %}
                {% for agent in planned_agents %}
                <article class="agent-card agent-official" data-agent-name="{{ agent.title | lower }}" data-agent-description="{{ agent.description | default(value='') | lower }}" data-agent-tags="{% if agent.taxonomies.tags %}{{ agent.taxonomies.tags | join(sep=' ') | lower }}{% endif %}">
                    <div class="agent-header">
                        <div class="agent-info">
                            <h3 class="agent-name">
                                <a href="{{ agent.permalink | safe }}">{{ agent.title }}</a>
                            </h3>
                            {% if agent.extra.author %}
                            <p class="agent-author">by {{ agent.extra.author }}</p>
                            {% endif %}
                        </div>
                        <div class="agent-header-right">
                            {% if agent.extra.version %}
                            <span class="agent-version">v{{ agent.extra.version }}</span>
                            {% endif %}
                            {% if agent.extra.status %}
                            <span class="agent-status {{ agent.extra.status | lower }}">{{ agent.extra.status }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <p class="agent-description">{{ agent.description | default(value="No description available.") }}</p>

                    {# Install methods badges #}
                    {% if agent.extra.crate_name or agent.extra.docker_image %}
                    <div class="agent-install-badges">
                        {% if agent.extra.crate_name %}
                        <span class="install-badge cargo" title="cargo install {{ agent.extra.crate_name }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 16 16"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linejoin="round" stroke-width="1"><path stroke-linecap="round" d="M1.5 7L8 10.5L14.5 7m-10-2.5l3.503 2L14.498 3M4.5 5.5v7m3.5-6V14"/><path stroke-linecap="round" d="M8.003 3L11.5 4.5v8"/><path stroke-linecap="square" d="M1.5 6.984V11l6.503 3.5L14.5 11V3L11 1.5l-6.5 3v1z"/></g></svg>
                            Cargo
                        </span>
                        {% endif %}
                        {% if agent.extra.docker_image %}
                        <span class="install-badge docker" title="docker pull {{ agent.extra.docker_image }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path fill="currentColor" d="M13.152.682a2.25 2.25 0 0 1 2.269 0l.007.004l6.957 4.276a2.28 2.28 0 0 1 1.126 1.964v7.516c0 .81-.432 1.56-1.133 1.968l-.002.001l-11.964 7.037l-.004.003c-.706.41-1.578.41-2.284 0l-.026-.015l-6.503-4.502a2.27 2.27 0 0 1-1.096-1.943V9.438c0-.392.1-.77.284-1.1l.003-.006l.014-.026c.197-.342.48-.627.82-.827h.002L13.152.681Zm.757 1.295h-.001L2.648 8.616l6.248 4.247a.78.78 0 0 0 .758-.01h.001l11.633-6.804l-6.629-4.074a.75.75 0 0 0-.75.003ZM8.517 14.33a2.3 2.3 0 0 1-.393-.18l-.023-.014l-6.102-4.147v7.003c0 .275.145.528.379.664l.025.014l6.114 4.232zM18 9.709l-3.25 1.9v7.548L18 17.245Zm-7.59 4.438l-.002.002a2.3 2.3 0 0 1-.391.18v7.612l3.233-1.902v-7.552Zm9.09-5.316v7.532l2.124-1.25a.78.78 0 0 0 .387-.671V7.363Z"/></svg>
                            OCI
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if agent.taxonomies.tags %}
                    <div class="agent-tags">
                        {% for tag in agent.taxonomies.tags %}
                        <span class="agent-tag">{{ tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </article>
                {% endfor %}
            </div>
        </details>
        {% endif %}

        {# Community Agents #}
        <details class="agents-category" open>
            <summary class="category-header">
                <div class="category-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    <h2>Community Agents</h2>
                </div>
                <div class="category-meta">
                    <span class="agent-count">{{ community_agents | length }} agents</span>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </div>
            </summary>
            <p class="category-description">Built and maintained by the community</p>
            <div class="agents-grid">
                {% for agent in community_agents %}
                <article class="agent-card" data-agent-name="{{ agent.title | lower }}" data-agent-description="{{ agent.description | default(value='') | lower }}" data-agent-tags="{% if agent.taxonomies.tags %}{{ agent.taxonomies.tags | join(sep=' ') | lower }}{% endif %}">
                    <div class="agent-header">
                        <div class="agent-info">
                            <h3 class="agent-name">
                                <a href="{{ agent.permalink | safe }}">{{ agent.title }}</a>
                            </h3>
                            {% if agent.extra.author %}
                            <p class="agent-author">by {{ agent.extra.author }}</p>
                            {% endif %}
                        </div>
                        <div class="agent-header-right">
                            {% if agent.extra.version %}
                            <span class="agent-version">v{{ agent.extra.version }}</span>
                            {% endif %}
                            {% if agent.extra.status %}
                            <span class="agent-status {{ agent.extra.status | lower }}">{{ agent.extra.status }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <p class="agent-description">{{ agent.description | default(value="No description available.") }}</p>

                    {# Install methods badges #}
                    {% if agent.extra.crate_name or agent.extra.docker_image %}
                    <div class="agent-install-badges">
                        {% if agent.extra.crate_name %}
                        <span class="install-badge cargo" title="cargo install {{ agent.extra.crate_name }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 16 16"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linejoin="round" stroke-width="1"><path stroke-linecap="round" d="M1.5 7L8 10.5L14.5 7m-10-2.5l3.503 2L14.498 3M4.5 5.5v7m3.5-6V14"/><path stroke-linecap="round" d="M8.003 3L11.5 4.5v8"/><path stroke-linecap="square" d="M1.5 6.984V11l6.503 3.5L14.5 11V3L11 1.5l-6.5 3v1z"/></g></svg>
                            Cargo
                        </span>
                        {% endif %}
                        {% if agent.extra.docker_image %}
                        <span class="install-badge docker" title="docker pull {{ agent.extra.docker_image }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path fill="currentColor" d="M13.152.682a2.25 2.25 0 0 1 2.269 0l.007.004l6.957 4.276a2.28 2.28 0 0 1 1.126 1.964v7.516c0 .81-.432 1.56-1.133 1.968l-.002.001l-11.964 7.037l-.004.003c-.706.41-1.578.41-2.284 0l-.026-.015l-6.503-4.502a2.27 2.27 0 0 1-1.096-1.943V9.438c0-.392.1-.77.284-1.1l.003-.006l.014-.026c.197-.342.48-.627.82-.827h.002L13.152.681Zm.757 1.295h-.001L2.648 8.616l6.248 4.247a.78.78 0 0 0 .758-.01h.001l11.633-6.804l-6.629-4.074a.75.75 0 0 0-.75.003ZM8.517 14.33a2.3 2.3 0 0 1-.393-.18l-.023-.014l-6.102-4.147v7.003c0 .275.145.528.379.664l.025.014l6.114 4.232zM18 9.709l-3.25 1.9v7.548L18 17.245Zm-7.59 4.438l-.002.002a2.3 2.3 0 0 1-.391.18v7.612l3.233-1.902v-7.552Zm9.09-5.316v7.532l2.124-1.25a.78.78 0 0 0 .387-.671V7.363Z"/></svg>
                            OCI
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if agent.taxonomies.tags %}
                    <div class="agent-tags">
                        {% for tag in agent.taxonomies.tags %}
                        <span class="agent-tag">{{ tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </article>
                {% endfor %}

                {# Submit Your Agent placeholder card #}
                <article class="agent-card agent-card-submit">
                    <div class="submit-card-content">
                        <div class="submit-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>
                        </div>
                        <h3 class="agent-name">Submit Your Agent</h3>
                        <p class="agent-description">Built something useful? Share it with the community and get it listed here.</p>
                        <a href="https://github.com/raskell-io/sentinel.raskell.io/issues/new?template=new-agent.yml" class="btn btn-secondary btn-sm">
                            Get Listed
                        </a>
                    </div>
                </article>
            </div>
        </details>

        {# Create Your Own Agent CTA - Collapsible #}
        <details class="create-agent-details">
            <summary class="create-agent-summary">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></svg>
                <span>Create Your Own Agent</span>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
            </summary>
            <div class="create-agent-content">
                <p>
                    Extend Sentinel with custom functionality. Agents communicate via Unix sockets using the
                    <a href="https://crates.io/crates/sentinel-agent-protocol" target="_blank" rel="noopener">sentinel-agent-protocol</a> crate.
                </p>
                <div class="cta-steps">
                    <div class="cta-step">
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <strong>Start from the echo agent</strong>
                            <span>Clone the <a href="https://github.com/raskell-io/sentinel/tree/main/agents/echo" target="_blank" rel="noopener">reference implementation</a> as your starting point</span>
                        </div>
                    </div>
                    <div class="cta-step">
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <strong>Add the protocol dependency</strong>
                            <code>cargo add sentinel-agent-protocol</code>
                        </div>
                    </div>
                    <div class="cta-step">
                        <span class="step-number">3</span>
                        <div class="step-content">
                            <strong>Implement your logic</strong>
                            <span>Handle request/response events in your agent binary</span>
                        </div>
                    </div>
                    <div class="cta-step">
                        <span class="step-number">4</span>
                        <div class="step-content">
                            <strong>Submit to registry</strong>
                            <span>Open an issue to get your agent listed</span>
                        </div>
                    </div>
                </div>
                <div class="cta-actions">
                    <a href="https://github.com/raskell-io/sentinel/tree/main/agents/echo" class="btn btn-primary" target="_blank" rel="noopener">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                        Echo Agent
                    </a>
                    <a href="https://crates.io/crates/sentinel-agent-protocol" class="btn btn-secondary" target="_blank" rel="noopener">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                        Protocol Crate
                    </a>
                    <a href="https://github.com/raskell-io/sentinel.raskell.io/issues/new?template=new-agent.yml" class="btn btn-ghost">
                        Submit Agent
                    </a>
                </div>
            </div>
        </details>
    </div>
</section>

<script>
(function() {
    const searchInput = document.getElementById('agent-search');
    const agentCards = document.querySelectorAll('.agent-card[data-agent-name]');
    const categories = document.querySelectorAll('.agents-category');

    searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase().trim();

        agentCards.forEach(card => {
            const name = card.dataset.agentName || '';
            const description = card.dataset.agentDescription || '';
            const tags = card.dataset.agentTags || '';

            const matches = query === '' ||
                name.includes(query) ||
                description.includes(query) ||
                tags.includes(query);

            card.style.display = matches ? '' : 'none';
        });

        // Update category counts and visibility
        categories.forEach(category => {
            const grid = category.querySelector('.agents-grid');
            if (!grid) return;

            const visibleCards = grid.querySelectorAll('.agent-card[data-agent-name]:not([style*="display: none"])');
            const countEl = category.querySelector('.agent-count');

            if (countEl) {
                const count = visibleCards.length;
                countEl.textContent = count + (count === 1 ? ' agent' : ' agents');
            }

            // Keep categories expanded when searching
            if (query !== '' && visibleCards.length > 0) {
                category.open = true;
            }
        });
    });
})();
</script>
{% endblock %}
